# 2025-10-25 扫描 MVP 与就诊详情关联

## 变更概要
- 扫描 MVP：CameraX 预览/拍照/保存到应用私有目录，支持运行时权限请求。
- 文档入库：拍照后自动保存为 Document（type=scan），可选关联就诊 visitId。
- 就诊详情：新增详情页，展示就诊信息与关联文档列表，可跳转扫描并自动关联、或进入编辑。
- 导航拓展：新增路由 `visit/detail/{id}`、`scan`、`scan/{visitId}`；首页支持“去扫描”“新增就诊”，点击列表进入详情。
- DAO 响应式：`DocumentDao.getByVisit` 改为 `Flow<List<Document>>`。

## 新增文件
- app/src/main/java/com/lessup/medledger/ui/scan/ScanScreen.kt
- app/src/main/java/com/lessup/medledger/ui/scan/ScanViewModel.kt
- app/src/main/java/com/lessup/medledger/ui/visit/VisitDetailViewModel.kt
- app/src/main/java/com/lessup/medledger/ui/visit/VisitDetailScreen.kt
- app/src/main/java/com/lessup/medledger/data/repository/DocumentRepository.kt

## 修改文件
- app/src/main/AndroidManifest.xml（新增 CAMERA 权限）
- app/src/main/java/com/lessup/medledger/ui/navigation/NavGraph.kt（新增详情/扫描路由与流转）
- app/src/main/java/com/lessup/medledger/ui/home/HomeScreen.kt（新增“去扫描/新增就诊”按钮，点击项进入详情）
- app/src/main/java/com/lessup/medledger/data/dao/Daos.kt（DocumentDao.getByVisit -> Flow）
- app/src/main/java/com/lessup/medledger/ui/scan/ScanScreen.kt（支持 visitId 参数并入库）
- app/src/main/java/com/lessup/medledger/data/repository/DocumentRepository.kt（按 visitId 查询 Flow）

## 说明
- 当前扫描保存为 JPG 到应用私有目录（Pictures）；后续将支持多页、裁边/增强与 PDF 生成。
- 首页暂未展示文档缩略图，文档列表可在“就诊详情”中查看；后续将把最近文档露出到首页卡片。
